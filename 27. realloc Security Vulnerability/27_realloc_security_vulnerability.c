/**
 * @file 27_realloc_security_vulnerability.c
 * @author your name (you@domain.com)
 * @brief Password changing secenario
 * @version 0.1
 * @date 2023-02-17
 * 
 * @copyright Copyright (c) 2023
 * 
 */
#include <stdio.h>
#include <stdlib.h>
#include <string.h>


/**
 * @note realloc() tidak menghapus data pada memory address sebelumnya
 * @note tetapi realloc() hanya menyalin nilai dari memory address sebelumnya ke memory address yg baru
 */



int main(int argc, char const *argv[])
{   

    int *password_1 = malloc(sizeof(char) * 7);
    int *password_2 = malloc(sizeof(char) * 7);

    strcpy(password_1, "abc123");
    strcpy(password_2, "xyz789");

    for (int i = 0; i <  7; i++) printf("%c", password_1[i]);
    printf("\n");
    for (int i = 0; i <  7; i++) printf("%c", password_2[i]);
    
    printf("\npassword_1 address: %p\npassword_2 address: %p\n", password_1, password_2);

    int *save_addr_before_realloc = password_1;

    password_1 = realloc(password_1, sizeof(char) * 20);

    printf("\npassword_1 address: %p\npassword_2 address: %p\n", password_1, password_2);
    printf("\npassword_1 address before realloc: %p\npassword_1 address after realloc: %p\n", (int) save_addr_before_realloc, (int) password_1);

      for (int i = 0; i < 100; i++) printf("%c", save_addr_before_realloc[i]);
      printf("\n");
      for (int i = 0; i < 100; i++) printf("%c", password_1[i]);

    return 0;
}
